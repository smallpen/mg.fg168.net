# AlertManager è¨­å®šæª”

global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@your-domain.com'
  smtp_auth_username: 'alerts@your-domain.com'
  smtp_auth_password: 'your-email-password'

# è­¦å ±è·¯ç”±è¦å‰‡
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
    # åš´é‡è­¦å ±ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
    
    # ä¸€èˆ¬è­¦å‘Š
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 30m

# æ¥æ”¶å™¨è¨­å®š
receivers:
  # é è¨­æ¥æ”¶å™¨
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://127.0.0.1:5001/'

  # åš´é‡è­¦å ±æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@your-domain.com'
        subject: 'ğŸš¨ [CRITICAL] Laravel Admin ç³»çµ±è­¦å ±'
        body: |
          è­¦å ±åç¨±: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          
          è©³ç´°è³‡è¨Š:
          {{ range .Alerts }}
          - è­¦å ±: {{ .Annotations.summary }}
          - æè¿°: {{ .Annotations.description }}
          - åš´é‡ç¨‹åº¦: {{ .Labels.severity }}
          - æ™‚é–“: {{ .StartsAt }}
          {{ end }}
          
          è«‹ç«‹å³æª¢æŸ¥ç³»çµ±ç‹€æ…‹ï¼
        headers:
          Subject: 'ğŸš¨ [CRITICAL] Laravel Admin ç³»çµ±è­¦å ±'
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#alerts'
        title: 'ğŸš¨ åš´é‡è­¦å ±'
        text: |
          {{ range .Alerts }}
          *è­¦å ±:* {{ .Annotations.summary }}
          *æè¿°:* {{ .Annotations.description }}
          *æ™‚é–“:* {{ .StartsAt }}
          {{ end }}
        color: 'danger'
        send_resolved: true

  # ä¸€èˆ¬è­¦å‘Šæ¥æ”¶å™¨
  - name: 'warning-alerts'
    email_configs:
      - to: 'dev-team@your-domain.com'
        subject: 'âš ï¸ [WARNING] Laravel Admin ç³»çµ±è­¦å‘Š'
        body: |
          è­¦å‘Šåç¨±: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          
          è©³ç´°è³‡è¨Š:
          {{ range .Alerts }}
          - è­¦å‘Š: {{ .Annotations.summary }}
          - æè¿°: {{ .Annotations.description }}
          - åš´é‡ç¨‹åº¦: {{ .Labels.severity }}
          - æ™‚é–“: {{ .StartsAt }}
          {{ end }}
          
          è«‹é—œæ³¨ç³»çµ±ç‹€æ…‹ã€‚
        headers:
          Subject: 'âš ï¸ [WARNING] Laravel Admin ç³»çµ±è­¦å‘Š'
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#monitoring'
        title: 'âš ï¸ ç³»çµ±è­¦å‘Š'
        text: |
          {{ range .Alerts }}
          *è­¦å‘Š:* {{ .Annotations.summary }}
          *æè¿°:* {{ .Annotations.description }}
          *æ™‚é–“:* {{ .StartsAt }}
          {{ end }}
        color: 'warning'
        send_resolved: true

# æŠ‘åˆ¶è¦å‰‡
inhibit_rules:
  # å¦‚æœæ‡‰ç”¨ç¨‹å¼å®Œå…¨ç„¡æ³•å­˜å–ï¼Œå‰‡æŠ‘åˆ¶å…¶ä»–ç›¸é—œè­¦å ±
  - source_match:
      alertname: 'LaravelAppDown'
    target_match:
      alertname: 'HighErrorRate'
  
  - source_match:
      alertname: 'LaravelAppDown'
    target_match:
      alertname: 'HighResponseTime'

# éœéŸ³è¦å‰‡ç¯„æœ¬
templates:
  - '/etc/alertmanager/templates/*.tmpl'