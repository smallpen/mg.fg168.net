# 角色管理功能需求文件

## 簡介

角色管理功能是權限系統的核心模組，提供系統角色的完整 CRUD 操作，包含角色與權限的關聯管理、權限矩陣視圖，以及角色層級管理。此功能確保系統管理員能夠靈活地定義和管理不同的使用者角色及其對應的權限。

## 需求

### 需求 1：角色列表顯示

**使用者故事：** 作為系統管理員，我想要檢視所有系統角色的列表，以便了解目前的角色配置並進行管理。

#### 驗收標準

1. WHEN 管理員存取角色列表頁面 THEN 系統 SHALL 顯示包含以下欄位的角色表格：
   - 角色名稱（系統識別名稱）
   - 顯示名稱（使用者友善名稱）
   - 角色描述
   - 權限數量
   - 使用者數量
   - 建立時間
   - 操作按鈕（檢視、編輯、刪除、複製）

2. WHEN 角色列表資料超過 20 筆 THEN 系統 SHALL 提供分頁功能，每頁顯示 20 筆資料

3. WHEN 管理員沒有 'roles.view' 權限 THEN 系統 SHALL 拒絕存取並顯示權限不足訊息

### 需求 2：角色搜尋和篩選

**使用者故事：** 作為系統管理員，我想要能夠搜尋和篩選角色，以便快速找到需要管理的角色。

#### 驗收標準

1. WHEN 管理員在搜尋框輸入關鍵字 THEN 系統 SHALL 即時篩選符合以下條件的角色：
   - 角色名稱包含關鍵字（不區分大小寫）
   - 顯示名稱包含關鍵字（不區分大小寫）
   - 角色描述包含關鍵字（不區分大小寫）

2. WHEN 管理員選擇權限數量篩選 THEN 系統 SHALL 依據權限數量範圍篩選角色

3. WHEN 管理員選擇使用者數量篩選 THEN 系統 SHALL 依據使用者數量範圍篩選角色

### 需求 3：角色建立功能

**使用者故事：** 作為系統管理員，我想要能夠建立新的角色，以便為不同類型的使用者定義適當的權限組合。

#### 驗收標準

1. WHEN 管理員點擊「建立角色」按鈕 AND 擁有 'roles.create' 權限 THEN 系統 SHALL 顯示角色建立表單

2. WHEN 管理員填寫角色資訊並提交 THEN 系統 SHALL 驗證以下欄位：
   - 角色名稱（必填、唯一、英文字母和底線）
   - 顯示名稱（必填、最大 50 字元）
   - 角色描述（選填、最大 255 字元）

3. WHEN 角色建立成功 THEN 系統 SHALL 重新導向到權限設定頁面

4. WHEN 角色名稱重複 THEN 系統 SHALL 顯示「角色名稱已存在」錯誤訊息

### 需求 4：角色編輯功能

**使用者故事：** 作為系統管理員，我想要能夠編輯現有角色的資訊和權限，以便調整角色配置。

#### 驗收標準

1. WHEN 管理員點擊「編輯」按鈕 AND 擁有 'roles.edit' 權限 THEN 系統 SHALL 顯示角色編輯表單

2. WHEN 管理員修改角色資訊並提交 THEN 系統 SHALL 更新角色資料並顯示成功訊息

3. WHEN 編輯系統預設角色 THEN 系統 SHALL 限制修改角色名稱和核心權限

4. WHEN 角色正在被使用者使用 THEN 系統 SHALL 顯示警告訊息但允許編輯

### 需求 5：權限矩陣管理

**使用者故事：** 作為系統管理員，我想要透過視覺化的權限矩陣來管理角色權限，以便直觀地設定和檢視權限配置。

#### 驗收標準

1. WHEN 管理員存取權限矩陣頁面 THEN 系統 SHALL 顯示以模組分組的權限列表

2. WHEN 管理員勾選或取消勾選權限 THEN 系統 SHALL 即時更新角色權限關聯

3. WHEN 權限有依賴關係 THEN 系統 SHALL 自動勾選或取消相關權限

4. WHEN 管理員批量選擇模組權限 THEN 系統 SHALL 一次性設定該模組的所有權限

### 需求 6：角色刪除功能

**使用者故事：** 作為系統管理員，我想要能夠刪除不需要的角色，以便保持系統的整潔。

#### 驗收標準

1. WHEN 管理員點擊「刪除」按鈕 AND 擁有 'roles.delete' 權限 THEN 系統 SHALL 顯示刪除確認對話框

2. WHEN 角色仍有使用者關聯 THEN 系統 SHALL 禁止刪除並顯示相關使用者列表

3. WHEN 角色為系統預設角色 THEN 系統 SHALL 禁止刪除並顯示警告訊息

4. WHEN 確認刪除 THEN 系統 SHALL 刪除角色及其權限關聯並記錄操作日誌

### 需求 7：角色複製功能

**使用者故事：** 作為系統管理員，我想要能夠複製現有角色，以便快速建立相似的角色配置。

#### 驗收標準

1. WHEN 管理員點擊「複製」按鈕 THEN 系統 SHALL 建立角色副本並自動命名

2. WHEN 複製角色 THEN 系統 SHALL 複製所有權限設定但不複製使用者關聯

3. WHEN 複製完成 THEN 系統 SHALL 重新導向到新角色的編輯頁面

### 需求 8：角色統計資訊

**使用者故事：** 作為系統管理員，我想要檢視角色的統計資訊，以便了解角色的使用情況。

#### 驗收標準

1. WHEN 管理員檢視角色詳情 THEN 系統 SHALL 顯示以下統計資訊：
   - 擁有此角色的使用者數量
   - 角色包含的權限數量
   - 按模組分組的權限分佈
   - 最近的權限變更記錄

2. WHEN 統計資料變更 THEN 系統 SHALL 即時更新顯示

### 需求 9：角色層級管理

**使用者故事：** 作為系統管理員，我想要設定角色的層級關係，以便實現階層式的權限管理。

#### 驗收標準

1. WHEN 管理員設定角色層級 THEN 系統 SHALL 確保不會產生循環依賴

2. WHEN 子角色繼承父角色權限 THEN 系統 SHALL 自動包含父角色的所有權限

3. WHEN 父角色權限變更 THEN 系統 SHALL 自動更新所有子角色的權限

### 需求 10：批量操作功能

**使用者故事：** 作為系統管理員，我想要能夠批量管理角色，以便提高管理效率。

#### 驗收標準

1. WHEN 管理員選擇多個角色 THEN 系統 SHALL 提供批量操作選項

2. WHEN 執行批量刪除 THEN 系統 SHALL 檢查每個角色的刪除條件

3. WHEN 執行批量權限設定 THEN 系統 SHALL 為選中的角色統一設定權限

4. WHEN 批量操作完成 THEN 系統 SHALL 顯示操作結果摘要